<!DOCTYPE html>
<html>

<head>
      <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-N8NXZ3S9');</script>
    <!-- End Google Tag Manager -->
    <title>MiawGtmTestSite</title>
</head>

<body>
    PAGE 1

    <a href="page2.html">Page 2</a>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N8NXZ3S9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <button type="button" id="btn">Send location.href to Salesforce</button>
</body>



<script>
document.getElementById("btn").addEventListener("click", sendLocation, false);

async function sendLocation(){
      console.log("sending");
      localToken = JSON.parse(localStorage.getItem('00DHs000003V7iM_WEB_STORAGE'));
     
      var data = { 
        "convIdentifier": Object.keys(localToken)[0],
        "msData": window.location.href
      }
      
      if (JSON.parse(localStorage.getItem('00DHs000003V7iM_WEB_STORAGE')).JWT){
          const response = await fetch('https://czeigler-240109-1-demo.my.salesforce-sites.com/services/apexrest/messagingPostUserData', {
            method: "POST", 
            mode: "cors", 
            cache: "no-cache",
            credentials: "same-origin", 
            headers: {
              "Content-Type": "application/json",
            },
            redirect: "follow", 
            referrerPolicy: "no-referrer", 
            body: JSON.stringify(data), 
          });
      }
}
</script>

</html>
